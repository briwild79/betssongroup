import React, { useState, useEffect, useRef } from 'react';

const CarouselPrototype = () => {
  const [activeIndex, setActiveIndex] = useState(2); // Start with middle item
  const [isInteracting, setIsInteracting] = useState(false);
  const [isMobile, setIsMobile] = useState(false);
  const carouselRef = useRef(null);
  const autoPlayRef = useRef(null);
  const touchStartX = useRef(null);

  // Detect mobile
  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth <= 768);
    };
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  // 5 items with middle one centered
  const items = Array.from({ length: 5 }, (_, i) => ({
    id: i,
    title: `Title ${i + 1}`,
    subtitle: `Subtitle`,
    color: ['#4A90E2', '#E94B3C', '#6B5B95', '#88B04B', '#F7CAC9'][i]
  }));

  // Auto-play
  useEffect(() => {
    if (!isInteracting) {
      autoPlayRef.current = setInterval(() => {
        setActiveIndex(prev => (prev + 1) % items.length);
      }, 4000);
    }

    return () => {
      if (autoPlayRef.current) {
        clearInterval(autoPlayRef.current);
      }
    };
  }, [isInteracting, items.length]);

  // Scroll to center active item
  useEffect(() => {
    if (carouselRef.current) {
      const container = carouselRef.current;
      const items = container.querySelectorAll('.carousel-item');
      const activeItem = items[activeIndex];
      
      if (activeItem) {
        const containerWidth = container.offsetWidth;
        const itemLeft = activeItem.offsetLeft;
        const itemWidth = activeItem.offsetWidth;
        const scrollTarget = itemLeft - (containerWidth / 2) + (itemWidth / 2);
        
        container.scrollTo({
          left: scrollTarget,
          behavior: 'smooth'
        });
      }
    }
  }, [activeIndex]);

  const handleItemClick = (index) => {
    setActiveIndex(index);
    setIsInteracting(true);
    setTimeout(() => setIsInteracting(false), 6000);
  };

  const handleSwipe = (direction) => {
    if (direction === 'left') {
      setActiveIndex(prev => (prev + 1) % items.length);
    } else {
      setActiveIndex(prev => (prev - 1 + items.length) % items.length);
    }
    setIsInteracting(true);
    setTimeout(() => setIsInteracting(false), 6000);
  };

  // Touch handling
  const handleTouchStart = (e) => {
    touchStartX.current = e.touches[0].clientX;
  };

  const handleTouchEnd = (e) => {
    if (!touchStartX.current) return;
    
    const touchEndX = e.changedTouches[0].clientX;
    const diff = touchStartX.current - touchEndX;
    
    if (Math.abs(diff) > 50) {
      handleSwipe(diff > 0 ? 'left' : 'right');
    }
    
    touchStartX.current = null;
  };

  // Calculate item position relative to center
  const getItemStyle = (index) => {
    const distance = Math.abs(activeIndex - index);
    const isActive = activeIndex === index;
    const isAdjacent = distance === 1;
    
    // Base dimensions
    const portraitWidth = isMobile ? '90px' : '120px';
    const portraitHeight = isMobile ? '135px' : '180px';
    const landscapeWidth = isMobile ? '200px' : '280px';
    const landscapeHeight = isMobile ? '112px' : '157px';
    
    return {
      width: isActive ? landscapeWidth : portraitWidth,
      height: isActive ? landscapeHeight : portraitHeight,
      transform: `scale(${isActive ? 1 : isAdjacent ? 0.85 : 0.7})`,
      opacity: isActive ? 1 : isAdjacent ? 0.6 : 0.4,
      zIndex: isActive ? 10 : 5 - distance,
    };
  };

  return (
    <div style={{ 
      padding: '0',
      background: '#141414',
      minHeight: '100vh',
      color: 'white',
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
      display: 'flex',
      flexDirection: 'column',
      justifyContent: 'center',
    }}>
      {/* Header */}
      <div style={{
        textAlign: 'center',
        padding: '20px',
        marginBottom: isMobile ? '10px' : '20px',
      }}>
        <h1 style={{ 
          fontSize: isMobile ? '18px' : '24px',
          margin: '0 0 5px 0',
          fontWeight: '500',
          opacity: 0.9,
        }}>
          Center-Focused Carousel
        </h1>
        <p style={{ 
          opacity: 0.4, 
          fontSize: isMobile ? '11px' : '12px', 
          margin: 0,
        }}>
          Always one in center • Portrait to landscape transform
        </p>
      </div>
      
      {/* Carousel container */}
      <div 
        ref={carouselRef}
        onTouchStart={handleTouchStart}
        onTouchEnd={handleTouchEnd}
        style={{
          position: 'relative',
          overflowX: 'auto',
          overflowY: 'hidden',
          scrollBehavior: 'smooth',
          WebkitOverflowScrolling: 'touch',
          scrollbarWidth: 'none',
          msOverflowStyle: 'none',
          height: isMobile ? '200px' : '260px',
          display: 'flex',
          alignItems: 'center',
          // Visual guides for center (remove in production)
          background: 'linear-gradient(90deg, transparent 48%, rgba(255,255,255,0.02) 48%, rgba(255,255,255,0.02) 52%, transparent 52%)',
        }}
      >
        {/* Items container with proper centering */}
        <div style={{
          display: 'flex',
          gap: isMobile ? '15px' : '20px',
          alignItems: 'center',
          padding: `0 calc(50vw - ${isMobile ? '100px' : '140px'})`,
          height: '100%',
        }}>
          {items.map((item, index) => {
            const style = getItemStyle(index);
            const isActive = activeIndex === index;
            
            return (
              <div
                key={item.id}
                className="carousel-item"
                onClick={() => handleItemClick(index)}
                style={{
                  flexShrink: 0,
                  transition: 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)',
                  cursor: 'pointer',
                  backgroundColor: item.color,
                  borderRadius: '8px',
                  display: 'flex',
                  flexDirection: 'column',
                  justifyContent: 'flex-end',
                  position: 'relative',
                  overflow: 'hidden',
                  ...style,
                  // Low-fi shadow
                  boxShadow: isActive 
                    ? '0 10px 30px rgba(0,0,0,0.6)' 
                    : '0 5px 15px rgba(0,0,0,0.4)',
                }}
              >
                {/* Simple gradient overlay */}
                <div style={{
                  position: 'absolute',
                  inset: 0,
                  background: 'linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 70%)',
                }} />
                
                {/* Content */}
                <div style={{
                  padding: isMobile ? '12px' : '16px',
                  position: 'relative',
                  zIndex: 1,
                }}>
                  <div style={{
                    fontSize: isActive ? (isMobile ? '16px' : '20px') : (isMobile ? '14px' : '16px'),
                    fontWeight: '500',
                    marginBottom: '2px',
                    transition: 'font-size 0.6s ease',
                  }}>
                    {item.title}
                  </div>
                  
                  <div style={{
                    fontSize: isMobile ? '10px' : '12px',
                    opacity: 0.6,
                  }}>
                    {item.subtitle}
                  </div>
                  
                  {/* Show extra info only when active */}
                  {isActive && (
                    <div style={{
                      marginTop: '8px',
                      fontSize: '10px',
                      opacity: 0,
                      animation: 'fadeIn 0.6s ease 0.3s forwards',
                    }}>
                      <span style={{ 
                        display: 'inline-block',
                        padding: '2px 6px',
                        backgroundColor: 'rgba(255,255,255,0.2)',
                        borderRadius: '4px',
                        marginRight: '6px'
                      }}>NEW</span>
                      <span style={{ opacity: 0.6 }}>2024</span>
                    </div>
                  )}
                </div>

                {/* Center indicator for active item */}
                {isActive && (
                  <div style={{
                    position: 'absolute',
                    bottom: '-2px',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    width: '40px',
                    height: '3px',
                    backgroundColor: 'white',
                    borderRadius: '3px',
                    opacity: 0.8,
                  }} />
                )}
              </div>
            );
          })}
        </div>
      </div>

      {/* Navigation arrows (desktop only) */}
      {!isMobile && (
        <>
          <button
            onClick={() => handleSwipe('right')}
            style={{
              position: 'absolute',
              left: '20px',
              top: '50%',
              transform: 'translateY(-50%)',
              width: '40px',
              height: '40px',
              borderRadius: '50%',
              border: '1px solid rgba(255,255,255,0.2)',
              backgroundColor: 'rgba(0,0,0,0.5)',
              color: 'white',
              fontSize: '18px',
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              transition: 'all 0.3s ease',
            }}
            onMouseEnter={(e) => e.target.style.backgroundColor = 'rgba(0,0,0,0.8)'}
            onMouseLeave={(e) => e.target.style.backgroundColor = 'rgba(0,0,0,0.5)'}
          >
            ←
          </button>
          <button
            onClick={() => handleSwipe('left')}
            style={{
              position: 'absolute',
              right: '20px',
              top: '50%',
              transform: 'translateY(-50%)',
              width: '40px',
              height: '40px',
              borderRadius: '50%',
              border: '1px solid rgba(255,255,255,0.2)',
              backgroundColor: 'rgba(0,0,0,0.5)',
              color: 'white',
              fontSize: '18px',
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              transition: 'all 0.3s ease',
            }}
            onMouseEnter={(e) => e.target.style.backgroundColor = 'rgba(0,0,0,0.8)'}
            onMouseLeave={(e) => e.target.style.backgroundColor = 'rgba(0,0,0,0.5)'}
          >
            →
          </button>
        </>
      )}

      {/* Dot indicators */}
      <div style={{
        display: 'flex',
        justifyContent: 'center',
        gap: '8px',
        marginTop: '30px',
      }}>
        {items.map((_, index) => (
          <button
            key={index}
            onClick={() => handleItemClick(index)}
            style={{
              width: activeIndex === index ? '24px' : '8px',
              height: '8px',
              borderRadius: '4px',
              border: 'none',
              backgroundColor: activeIndex === index ? 'white' : 'rgba(255,255,255,0.3)',
              transition: 'all 0.3s ease',
              cursor: 'pointer',
              padding: 0,
            }}
          />
        ))}
      </div>

      {/* Design notes */}
      <div style={{
        maxWidth: '400px',
        margin: '40px auto 20px',
        padding: '20px',
        backgroundColor: 'rgba(255,255,255,0.05)',
        borderRadius: '8px',
        fontSize: '12px',
        lineHeight: '1.6',
      }}>
        <h3 style={{ marginTop: 0, fontSize: '14px', opacity: 0.9 }}>UI Design Principles Applied:</h3>
        <ul style={{ marginLeft: '20px', opacity: 0.7, paddingLeft: '0', listStyle: 'none' }}>
          <li>✓ Always one item centered (focal point)</li>
          <li>✓ Center item expands to landscape</li>
          <li>✓ Adjacent items visible (shows scrollability)</li>
          <li>✓ Progressive scaling creates depth</li>
          <li>✓ Clear visual hierarchy</li>
          <li>✓ Smooth transitions maintain context</li>
        </ul>
      </div>

      <style>{`
        @keyframes fadeIn {
          to { opacity: 1; }
        }
        
        *::-webkit-scrollbar {
          display: none;
        }
      `}</style>
    </div>
  );
};

export default CarouselPrototype;
