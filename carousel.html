import React, { useState, useEffect, useRef } from 'react';
import { ChevronLeft, ChevronRight } from 'lucide-react';

const PortraitCarousel = () => {
  const [currentIndex, setCurrentIndex] = useState(2); // Start with middle item
  const [isAutoPlaying, setIsAutoPlaying] = useState(true);
  const touchStartX = useRef(null);
  const touchEndX = useRef(null);
  
  /* 
   * MARKETING TEAM CONTENT GUIDE
   * ============================
   * 
   * ACCESSIBILITY NOTE: Text sizes are optimized to be as small as possible
   * while maintaining WCAG AA compliance (min 12px on mobile)
   * 
   * For each carousel item, provide:
   * 
   * 1. IMAGE SPECIFICATIONS:
   *    - Format: JPG or WebP (WebP preferred for better performance)
   *    - Dimensions: 440x560px (portrait, 11:14 ratio)
   *    - File size: Under 200KB per image
   *    - Resolution: 2x for retina displays
   * 
   * 2. TEXT CONTENT:
   *    - title: Main headline (max 30 characters)
   *    - subtitle: Supporting text (max 50 characters)
   *    - description: Additional detail text (max 60 characters, optional)
   *    - ctaText: Call-to-action button text (optional)
   *    - link: Where the card should navigate to (optional)
   * 
   * 3. STYLING:
   *    - overlayColor: Dark overlay for text readability (e.g., "bg-black/40")
   *    - textPosition: Where to place text ("top", "center", "bottom")
   */
  
  const items = [
    {
      id: 1,
      // Replace with actual image URL when available
      imageUrl: "/api/placeholder/440/560",
      imageAlt: "Club World Cup football match action",
      title: "Get Ready for the Club World Cup!",
      subtitle: "Bet €10 on any match and get a €5 Free Bet",
      description: "for the final!",
      ctaText: "Bet Now & Claim Your Free Bet",
      link: "/sports/club-world-cup",
      overlayColor: "bg-gradient-to-t from-black/70 via-black/50 to-transparent",
      textPosition: "bottom"
    },
    {
      id: 2,
      imageUrl: "/api/placeholder/440/560",
      imageAlt: "Wimbledon tennis championship court",
      title: "Wimbledon 2025 - Place Your Bets",
      subtitle: "Bet €20 on Wimbledon and get 10 Free Spins",
      description: "on Wimbledon-themed slots!",
      ctaText: "Bet on Wimbledon & Spin for Free!",
      link: "/sports/wimbledon",
      overlayColor: "bg-gradient-to-t from-green-900/70 via-black/50 to-transparent",
      textPosition: "bottom"
    },
    {
      id: 3,
      imageUrl: "/api/placeholder/440/560",
      imageAlt: "Premier League football match",
      title: "Bet on Premier League Matches!",
      subtitle: "Place a €15 bet on any Premier League game",
      description: "and get a €10 casino bonus to use on slots.",
      ctaText: "Bet on Premier League Now",
      link: "/sports/premier-league",
      overlayColor: "bg-gradient-to-t from-purple-900/70 via-black/50 to-transparent",
      textPosition: "bottom"
    },
    {
      id: 4,
      imageUrl: "/api/placeholder/440/560",
      imageAlt: "Starburst slot game graphics",
      title: "Exclusive Slots Offer Just for You!",
      subtitle: "Deposit €50 and get 100 Free Spins on our",
      description: "latest slot game - Starburst!",
      ctaText: "Claim Your 100 Free Spins",
      link: "/casino/slots/starburst",
      overlayColor: "bg-gradient-to-t from-pink-900/70 via-purple-900/50 to-transparent",
      textPosition: "bottom"
    },
    {
      id: 5,
      imageUrl: "/api/placeholder/440/560",
      imageAlt: "Live casino dealer at blackjack table",
      title: "Live Casino - Real Dealers, Real Wins",
      subtitle: "Make your first deposit of €30 and receive",
      description: "a €50 Live Casino bonus.",
      ctaText: "Play Live Casino Now",
      link: "/casino/live",
      overlayColor: "bg-gradient-to-t from-red-900/70 via-black/50 to-transparent",
      textPosition: "bottom"
    }
  ];

  // Auto-play functionality
  useEffect(() => {
    if (!isAutoPlaying) return;
    
    const interval = setInterval(() => {
      setCurrentIndex((prev) => (prev + 1) % items.length);
    }, 3000);

    return () => clearInterval(interval);
  }, [isAutoPlaying, items.length]);

  // Handle swipe gestures
  const handleTouchStart = (e) => {
    touchStartX.current = e.touches[0].clientX;
    setIsAutoPlaying(false);
  };

  const handleTouchMove = (e) => {
    touchEndX.current = e.touches[0].clientX;
  };

  const handleTouchEnd = () => {
    if (!touchStartX.current || !touchEndX.current) return;
    
    const diff = touchStartX.current - touchEndX.current;
    const threshold = 50;

    if (Math.abs(diff) > threshold) {
      if (diff > 0) {
        // Swiped left
        setCurrentIndex((prev) => (prev + 1) % items.length);
      } else {
        // Swiped right
        setCurrentIndex((prev) => (prev - 1 + items.length) % items.length);
      }
    }

    // Reset touch positions
    touchStartX.current = null;
    touchEndX.current = null;
    
    // Resume auto-play after interaction
    setTimeout(() => setIsAutoPlaying(true), 5000);
  };

  const goToSlide = (index) => {
    setCurrentIndex(index);
    setIsAutoPlaying(false);
    setTimeout(() => setIsAutoPlaying(true), 5000);
  };

  const handleCardClick = (index, link) => {
    if (index === currentIndex && link) {
      // Navigate to link (replace with your navigation method)
      window.location.href = link;
    } else {
      goToSlide(index);
    }
  };

  const getItemStyle = (index) => {
    const diff = index - currentIndex;
    const normalizedDiff = diff > 2 ? diff - items.length : diff < -2 ? diff + items.length : diff;
    
    // Calculate position, scale, and opacity based on distance from center
    const absNormalizedDiff = Math.abs(normalizedDiff);
    let scale, opacity, zIndex, blur;
    
    // Different scaling for different screen sizes
    const isMobile = window.innerWidth < 640;
    const isTablet = window.innerWidth >= 640 && window.innerWidth < 1024;
    
    if (absNormalizedDiff === 0) {
      // Center item
      scale = 1;
      opacity = 1;
      zIndex = 50;
      blur = 0;
    } else if (absNormalizedDiff === 1) {
      // Adjacent items
      scale = isMobile ? 0.75 : isTablet ? 0.8 : 0.85;
      opacity = isMobile ? 0.6 : 0.75;
      zIndex = 40;
      blur = 0;
    } else if (absNormalizedDiff === 2) {
      // Outer items
      scale = isMobile ? 0.6 : isTablet ? 0.65 : 0.7;
      opacity = isMobile ? 0.3 : 0.5;
      zIndex = 30;
      blur = isMobile ? 2 : 1;
    } else {
      // Hidden items
      scale = 0.5;
      opacity = 0;
      zIndex = 20;
      blur = 3;
    }
    
    // Dynamic spacing based on screen size
    let spacing;
    if (isMobile) {
      spacing = normalizedDiff * 25; // vw units for mobile
    } else if (isTablet) {
      spacing = normalizedDiff * 20; // vw units for tablet
    } else {
      spacing = normalizedDiff * 15; // vw units for desktop
    }
    
    return {
      transform: `translateX(${spacing}vw) scale(${scale})`,
      opacity,
      zIndex,
      filter: blur > 0 ? `blur(${blur}px)` : 'none',
    };
  };

  const getTextPositionClasses = (position) => {
    switch (position) {
      case 'top':
        return 'justify-start pt-4 sm:pt-6';
      case 'center':
        return 'justify-center';
      case 'bottom':
      default:
        return 'justify-end pb-4 sm:pb-6';
    }
  };

  return (
    <div className="w-full px-4 sm:px-6 lg:px-8 py-8">
      {/* Carousel Container */}
      <div 
        className="relative h-56 sm:h-64 md:h-72 lg:h-80 mb-4 overflow-hidden"
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
        onTouchEnd={handleTouchEnd}
      >
        <div className="relative h-full flex items-center justify-center">
          {items.map((item, index) => (
            <div
              key={item.id}
              className="absolute transition-all duration-700 ease-out cursor-pointer"
              style={{
                ...getItemStyle(index),
                width: 'clamp(140px, 40vw, 220px)',
                height: 'clamp(180px, 50vw, 280px)',
              }}
              onClick={() => handleCardClick(index, item.link)}
            >
              {/* Portrait Card */}
              <div className="w-full h-full rounded-xl sm:rounded-2xl overflow-hidden relative bg-gray-100">
                {/* Image */}
                <img 
                  src={item.imageUrl}
                  alt={item.imageAlt}
                  className="w-full h-full object-cover"
                  loading={index === currentIndex ? "eager" : "lazy"}
                />
                
                {/* Overlay and Text */}
                <div className={`absolute inset-0 ${item.overlayColor} flex flex-col ${getTextPositionClasses(item.textPosition)} px-3 sm:px-4`}>
                  <div className="text-white">
                    <h3 className="text-sm sm:text-base md:text-lg font-bold leading-tight mb-0.5 drop-shadow-md">
                      {item.title}
                    </h3>
                    <p className="text-xs sm:text-sm leading-tight opacity-90 drop-shadow-md">
                      {item.subtitle}
                    </p>
                    {item.description && (
                      <p className="text-xs leading-tight mt-1 opacity-80 drop-shadow-md line-clamp-2">
                        {item.description}
                      </p>
                    )}
                    {item.ctaText && index === currentIndex && (
                      <button className="mt-2 bg-white text-black px-3 py-1 rounded-full text-xs font-medium hover:bg-opacity-90 transition-all transform hover:scale-105">
                        {item.ctaText}
                      </button>
                    )}
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* Navigation Arrows - visible on larger screens */}
        <button
          onClick={() => {
            setCurrentIndex((prev) => (prev - 1 + items.length) % items.length);
            setIsAutoPlaying(false);
            setTimeout(() => setIsAutoPlaying(true), 5000);
          }}
          className="hidden lg:flex absolute left-4 xl:left-8 top-1/2 -translate-y-1/2 z-50 bg-white/20 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/30 transition-all hover:scale-110"
        >
          <ChevronLeft size={28} />
        </button>
        <button
          onClick={() => {
            setCurrentIndex((prev) => (prev + 1) % items.length);
            setIsAutoPlaying(false);
            setTimeout(() => setIsAutoPlaying(true), 5000);
          }}
          className="hidden lg:flex absolute right-4 xl:right-8 top-1/2 -translate-y-1/2 z-50 bg-white/20 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/30 transition-all hover:scale-110"
        >
          <ChevronRight size={28} />
        </button>
      </div>

      {/* Dot Navigation */}
      <div className="flex items-center justify-center gap-1.5">
        {items.map((_, index) => (
          <button
            key={index}
            onClick={() => goToSlide(index)}
            className={`transition-all duration-300 rounded-full ${
              index === currentIndex 
                ? 'w-6 sm:w-8 h-1.5 sm:h-2 bg-gray-800' 
                : 'w-1.5 sm:w-2 h-1.5 sm:h-2 bg-gray-400 hover:bg-gray-600'
            }`}
            aria-label={`Go to slide ${index + 1}`}
          />
        ))}
      </div>
    </div>
  );
};

export default PortraitCarousel;
